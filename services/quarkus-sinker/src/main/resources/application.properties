# --- Quarkus App Config ---
# Set a unique app name for Kafka Streams
quarkus.application.name=adtech-sinker
quarkus.application.version=1.0.0

# --- Kafka Streams Config ---
# 1. The Kafka Broker
kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
# 2. The ID for this processing topology
# This also becomes the Consumer Group ID
quarkus.kafka-streams.application-id=adtech-sinker-processor
# 3. Where to start reading if it's a new app
quarkus.kafka-streams.auto-offset-reset=earliest
# 4. JSON Deserializer for the BidRequest object
quarkus.kafka-streams.topics.bids.value.serde=io.quarkus.kafka.client.serialization.ObjectMapperSerde
quarkus.kafka-streams.topics.bids.value.serde.json.type=com.example.adtech.BidRequest
# 5. Tell Kafka Streams which topic names map to which variable names
kafka-streams.topics-in=bids
kafka-streams.topics-dlq=bids-dlq
quarkus.kafka-streams.topics=bids,bids-dlq


# --- Database Config ---
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=${DB_USER:user}
quarkus.datasource.password=${DB_PASSWORD:password}
quarkus.datasource.jdbc.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:postgres}

# --- Hibernate Config ---
# Let Flyway handle schema management, not Hibernate
quarkus.hibernate-orm.database.generation=none

# --- Flyway Config ---
# Run migrations on startup
quarkus.flyway.migrate-at-start=true
# Baseline on first migration (for existing databases)
quarkus.flyway.baseline-on-migrate=true

# --- Dead Letter Queue (DLQ) Config ---
# Outgoing channel for failed messages
mp.messaging.outgoing.dlq-out.connector=smallrye-kafka
mp.messaging.outgoing.dlq-out.topic=bids-dlq
mp.messaging.outgoing.dlq-out.value.serializer=io.quarkus.kafka.client.serialization.ObjectMapperSerializer
